!function(){function t(){void 0===v.maps.uscounties.stateByAbb&&(v.maps.uscounties.stateByFIPS={},v.maps.uscounties.stateByAbb={},v.maps.uscounties.states.forEach(function(t){v.maps.uscounties.stateByFIPS[t.FP]=t,v.maps.uscounties.stateByAbb[t.ABB]=t}))}function e(t){return t[0]}function n(t){return t[1]}function r(t){return t.height}function a(t){return t.width}function i(t){return t.height/2}function u(t){return t.width/2}function o(t){return t.key}function s(t){return t.value}function c(t){var e;return function(n){return arguments.length?(e=n,t):e}}function d(t,e){var n;return function(r){return arguments.length?(n=r,t):"undefined"!=typeof n?n:e}}function l(t){for(;t>x;)t-=x;for(;0>t;)t+=x;return t}function f(t,e,n,r,a,i){if(0>=a||0>=r)return 0;var u=t.concat().sort(d3.ascending),o=r-u.length*e+(i?e:0),s=[],c=0,d=0;return d3.range(u.length).forEach(function(t){d=(o-n*t)/(a-=u[t-1]||0),c+=u[t]*d<=n?1:0,s.push(d)}),s[c]}function p(t,e,n,r,a){var i=r,u=d3.sum(t),o=f(t,e,n,a-r,u,!1),s=t.map(function(t){var r=o*t,a=(n>r?n:r)/2;return i+=2*a+e,{c:i-a,v:r,w:a,value:t,percent:t/(u||1)}});return s}function h(t){function e(t,e){return[t*Math.cos(e),t*Math.sin(e)]}var n=e(t[0],t[2]),r=e(t[0],t[3]),a=e(t[1],t[2]),i=e(t[1],t[3]);return["M",n,"A",t[0],t[0],"0",t[3]-t[2]>A?1:0,"1",r,"L",i,"A",t[1],t[1],"0",t[3]-t[2]>A?1:0,"0",a,"z"].join(" ")}function y(t,e,n,r,a,i){function u(t,e,n){return"A"+t+","+t+" 0 "+ +(n>A)+",1 "+e}function o(t,e){return[t*Math.cos(e),t*Math.sin(e)]}function s(t,e,n,r){n+=e>n?x:0;var a=n-e,i=1-(a>A?x-a:a)/A;i=Math.pow(i,5);var u=(n+e)/2-(n-e>A?A:0);return"Q"+i*r*Math.cos(u)+","+i*r*Math.sin(u)+" "+t}var c=o(t,e),d=o(t,n),l=o(r,a),f=o(r,i);return"M"+c+u(t,d,n-e)+(e==a&&n==i?s(c,e,n,r):s(l,n,a,r)+u(r,f,i-a)+s(c,e,i,t))+"Z"}function m(t,e){ret=[];for(var n=e;n>e-t;n--)ret.push(0>n?n+t:n);return ret}var v={version:"1.2.1"},x=2*Math.PI,A=Math.PI,k=Math.PI/2;v.maps={uscountyurl:"https://gist.githubusercontent.com/NPashaP/bf60b406b22a3bdf98f4483fddafdbb5/raw/5d9013e746e916eefe467750f7a11df91a3dc74f/us.json"},v.bP=function(){function t(i){y=i,i.each(function(){var i=d3.select(this),u=t.bars(),o=i.selectAll(".subBars").data(u.subBars).enter().append("g").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).attr("class","subBars").append("rect").attr("x",e).attr("y",n).attr("width",r).attr("height",a);"undefined"!=typeof h&&o.style("fill",function(t){return h(t)});var s=i.selectAll(".edges").data(u.edges).enter().append("path").attr("class","edges").attr("d",function(t){return t.path}).style("fill-opacity",t.edgeOpacity());"undefined"!=typeof h&&s.style("fill",function(t){return h(t)}),i.selectAll(".mainBars").data(u.mainBars).enter().append("g").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).attr("class","mainBars").append("rect").attr("x",e).attr("y",n).attr("width",r).attr("height",a).style("fill-opacity",0).on("mouseover",t.mouseover).on("mouseout",t.mouseout)})}function e(t){return-t.width}function n(t){return-t.height}function r(t){return 2*t.width}function a(t){return 2*t.height}var i,u,o,s,c,d,l,f,g,p,h,y,m,v,x,A,k;return t.data=function(e){return arguments.length?(p=e,t):p},t.fill=function(e){return arguments.length?(h=e,t):h},t.keyPrimary=function(e){return arguments.length?(i=e,t):"undefined"!=typeof i?i:function(t){return t[0]}},t.sortPrimary=function(e){return arguments.length?(x=e,t):"undefined"!=typeof x?x:d3.ascending},t.keySecondary=function(e){return arguments.length?(u=e,t):"undefined"!=typeof u?u:function(t){return t[1]}},t.sortSecondary=function(e){return arguments.length?(A=e,t):"undefined"!=typeof A?A:d3.ascending},t.value=function(e){return arguments.length?(o=e,t):"undefined"!=typeof o?o:function(t){return t[2]}},t.width=function(e){return arguments.length?(s=e,t):"undefined"!=typeof s?s:400},t.height=function(e){return arguments.length?(c=e,t):"undefined"!=typeof c?c:600},t.barSize=function(e){return arguments.length?(l=e,t):"undefined"!=typeof l?l:35},t.min=function(e){return arguments.length?(f=e,t):"undefined"!=typeof f?f:0},t.orient=function(e){return arguments.length?(d=e,t):"undefined"!=typeof d?d:"vertical"},t.pad=function(e){return arguments.length?(g=e,t):"undefined"!=typeof g?g:0},t.duration=function(e){return arguments.length?(v=e,t):"undefined"!=typeof v?v:500},t.edgeOpacity=function(e){return arguments.length?(m=e,t):"undefined"!=typeof m?m:.4},t.edgeMode=function(e){return arguments.length?(k=e,t):"undefined"!=typeof k?k:"curved"},t.bars=function(e){function n(t,n){return"undefined"==typeof e||e.part===n||d[e.part](t)===e.key}function r(){var e=t.min()/2;s.primary.forEach(function(t){t.height<e&&(t.height=e)}),s.secondary.forEach(function(t){t.height<e&&(t.height=e)})}function a(e){function r(r){return n(r,e)?t.value()(r):0}var a=d3.nest().key("primary"==e?t.keyPrimary():t.keySecondary()).sortKeys("primary"==e?t.sortPrimary():t.sortSecondary()).rollup(function(t){return d3.sum(t,r)}).entries(t.data()),i=o(a,t.pad(),t.min(),0,"vertical"==l?t.height():t.width()),u=t.barSize();a.forEach(function(n,r){s[e].push({x:"horizontal"==l?(i[r].s+i[r].e)/2:"primary"==e?u/2:t.width()-u/2,y:"vertical"==l?(i[r].s+i[r].e)/2:"primary"==e?u/2:t.height()-u/2,height:"vertical"==l?(i[r].e-i[r].s)/2:u/2,width:"horizontal"==l?(i[r].e-i[r].s)/2:u/2,part:e,key:n.key,value:n.value,percent:i[r].p})})}function i(e){function r(r){return n(r,e)?t.value()(r):0}var a=d3.map(s[e],function(t){return t.key}),i=d3.nest().key("primary"==e?t.keyPrimary():t.keySecondary()).sortKeys("primary"==e?t.sortPrimary():t.sortSecondary()).key("secondary"==e?t.keyPrimary():t.keySecondary()).sortKeys("secondary"==e?t.sortPrimary():t.sortSecondary()).rollup(function(t){return d3.sum(t,r)}).entries(t.data());i.forEach(function(n){var r=a.get(n.key),i=o(n.values,0,0,"vertical"==l?r.y-r.height:r.x-r.width,"vertical"==l?r.y+r.height:r.x+r.width),u=t.barSize();n.values.forEach(function(a,o){c[e].push({x:"vertical"==l?"primary"==e?u/2:t.width()-u/2:(i[o].s+i[o].e)/2,y:"horizontal"==l?"primary"==e?u/2:t.height()-u/2:(i[o].s+i[o].e)/2,height:("vertical"==l?i[o].e-i[o].s:u)/2,width:("horizontal"==l?i[o].e-i[o].s:u)/2,part:e,primary:"primary"==e?n.key:a.key,secondary:"primary"==e?a.key:n.key,value:a.value,percent:i[o].p*r.percent,index:"primary"==e?n.key+"|"+a.key:a.key+"|"+n.key})})})}function u(){function e(t,e,n,r,i,u,o,s){if("straight"==a)return["M",t,",",e,"L",n,",",r,"L",i,",",u,"L",o,",",s,"z"].join("");var c=(t+n)/2,d=(i+o)/2;return["M",t,",",e,"C",c,",",e," ",c,",",r,",",n,",",r,"L",i,",",u,"C",d,",",u," ",d,",",s,",",o,",",s,"z"].join("")}function n(t,e,n,r,i,u,o,s){if("straight"==a)return["M",t,",",e,"L",n,",",r,"L",i,",",u,"L",o,",",s,"z"].join("");var c=(e+r)/2,d=(u+s)/2;return["M",t,",",e,"C",t,",",c," ",n,",",c,",",n,",",r,"L",i,",",u,"C",i,",",d," ",o,",",d,",",o,",",s,"z"].join("")}var r=d3.map(c.secondary,function(t){return t.index}),a=t.edgeMode();return c.primary.map(function(t){var a=r.get(t.index);return{path:"vertical"===l?e(t.x+t.width,t.y+t.height,a.x-a.width,a.y+a.height,a.x-a.width,a.y-a.height,t.x+t.width,t.y-t.height):n(t.x-t.width,t.y+t.height,a.x-a.width,a.y-a.height,a.x+a.width,a.y-a.height,t.x+t.width,t.y+t.height),primary:t.primary,secondary:t.secondary,value:t.value,percent:t.percent}})}function o(t,e,n,r,a){var i=n/(a-r-2*t.length*e),u=0,o=0,s=d3.sum(t,function(t){return t.value});t.forEach(function(t){t.value<i*s&&(u+=1,o+=t.value)});var c=1e-5>s?0:(a-r-2*t.length*e-u*n)/(s-o),d=r,l=[];return t.forEach(function(t){var r=t.value*c;l.push({s:d+e+(n>r?.5*(n-r):0),e:d+e+(n>r?.5*(n+r):r),p:1e-5>s?0:t.value/s}),d+=2*e+(n>r?n:r)}),l}var s={primary:[],secondary:[]},c={primary:[],secondary:[]},d={primary:t.keyPrimary(),secondary:t.keySecondary()},l=t.orient();return a("primary"),a("secondary"),i("primary"),i("secondary"),r(),{mainBars:s.primary.concat(s.secondary),subBars:c.primary.concat(c.secondary),edges:u()}},t.update=function(i){p=i;var u=t.bars(),o=t.duration();y.selectAll(".subBars").data(u.subBars).transition().duration(o).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).select("rect").attr("x",e).attr("y",n).attr("width",r).attr("height",a),y.selectAll(".edges").data(u.edges).transition().duration(o).attr("d",function(t){return t.path}).style("fill-opacity",t.edgeOpacity()),y.selectAll(".mainBars").data(u.mainBars).transition().duration(o).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).select("rect").attr("x",e).attr("y",n).attr("width",r).attr("height",a).style("fill-opacity",0)},t.mouseover=function(i){var u=t.bars(i);y.selectAll(".mainBars").filter(function(t){return t.part===i.part&&t.key===i.key}).select("rect").style("stroke-opacity",1),y.selectAll(".subBars").data(u.subBars).transition().duration(t.duration()).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).select("rect").attr("x",e).attr("y",n).attr("width",r).attr("height",a);var o=y.selectAll(".edges").data(u.edges);o.filter(function(t){return t[i.part]===i.key}).transition().duration(t.duration()).style("fill-opacity",t.edgeOpacity()).attr("d",function(t){return t.path}),o.filter(function(t){return t[i.part]!==i.key}).transition().duration(t.duration()).style("fill-opacity",0).attr("d",function(t){return t.path}),y.selectAll(".mainBars").data(u.mainBars).transition().duration(t.duration()).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).select("rect").attr("x",e).attr("y",n).attr("width",r).attr("height",a)},t.mouseout=function(i){var u=t.bars();y.selectAll(".mainBars").filter(function(t){return t.part===i.part&&t.key===i.key}).select("rect").style("stroke-opacity",0),y.selectAll(".subBars").data(u.subBars).transition().duration(t.duration()).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).select("rect").attr("x",e).attr("y",n).attr("width",r).attr("height",a),y.selectAll(".edges").data(u.edges).transition().duration(t.duration()).style("fill-opacity",t.edgeOpacity()).attr("d",function(t){return t.path}),y.selectAll(".mainBars").data(u.mainBars).transition().duration(t.duration()).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).select("rect").attr("x",e).attr("y",n).attr("width",r).attr("height",a)},t},v.gg=function(){function t(e){l=e,e.each(function(){var e=d3.select(this),n=t.scale(),r=t.minorTickStart(),a=t.minorTickEnd(),i=t.majorTickStart(),u=t.majorTickEnd(),o=t.ticks(),s=t.majorTicks(),c=t.labelLocation(),d=t.outerRadius();e.append("circle").attr("r",d).style("fill","url(#vizgg3"+f+")").attr("class","face"),e.append("circle").attr("r",t.innerRadius()).style("fill","url(#vizgg2"+f+")").style("filter","url(#vizgg5"+f+")").attr("class","innerFace");var l=e.append("g");l.selectAll("line").data(o).enter().append("line").attr("class",function(t){return s(t)?"majorTicks":"minorTicks"}).attr("x1",function(t){return d*(s(t)?i:r)*Math.cos(n(t))}).attr("y1",function(t){return d*(s(t)?i:r)*Math.sin(n(t))}).attr("x2",function(t){return d*(s(t)?u:a)*Math.cos(n(t))}).attr("y2",function(t){return d*(s(t)?u:a)*Math.sin(n(t))}),e.selectAll("text").data(o.filter(s)).enter().append("text").attr("class","label").attr("x",function(t){return d*c*Math.cos(n(t))}).attr("y",function(t){return d*c*Math.sin(n(t))}).attr("dy",3).text(function(t){return t});var g=t.outerRadius()/b.outerRadius,p=180*t.scale()(t.value())/A+90;e.append("g").attr("transform","translate(1,1)").selectAll(".needleshadow").data([0]).enter().append("g").attr("transform","rotate("+p+")").attr("class","needleshadow").append("path").attr("d",["m 0",-130*g,5*g,175*g,-10*g,"0,z"].join(",")).style("filter","url(#vizgg6"+f+")"),e.selectAll(".needle").data([0]).enter().append("g").attr("transform","rotate("+p+")").attr("class","needle").append("polygon").attr("points",[-.5*g,-130*g,.5*g,-130*g,5*g,45*g,-5*g,45*g].join(",")).style("fill","url(#vizgg4"+f+")")})}var e,n,r,a,i,u,o,s,c,d,l,f,g,p,h,y,m,x,k,b={innerRadius:20,outerRadius:150,angleOffset:.7,startAngle:-1.5*A,endAngle:.5*A,minorTickStart:.9,minorTickEnd:.95,majorTickStart:.82,majorTickEnd:.95,needleColor:"#de2c2c",innerFaceColor:"#999999",faceColor:"#666666",domain:[0,100],duration:500,ease:"cubicInOut",ticks:d3.range(0,101,2),majorTicks:function(t){return t%10===0},labelLocation:.7};return t.scale=function(){return d3.scale.linear().domain(t.domain()).range([b.startAngle+t.angleOffset(),b.endAngle-t.angleOffset()])},t.innerRadius=function(n){return arguments.length?(e=n,t):"undefined"!=typeof e?e:b.innerRadius},t.outerRadius=function(e){return arguments.length?(n=e,t):"undefined"!=typeof n?n:b.outerRadius},t.angleOffset=function(e){return arguments.length?(s=e,t):"undefined"!=typeof s?s:b.angleOffset},t.labelLocation=function(e){return arguments.length?(k=e,t):"undefined"!=typeof k?k:b.labelLocation},t.ticks=function(e){return arguments.length?(g=e,t):"undefined"!=typeof g?g:b.ticks},t.majorTicks=function(e){return arguments.length?(p=e,t):"undefined"!=typeof p?p:b.majorTicks},t.minorTickStart=function(e){return arguments.length?(h=e,t):"undefined"!=typeof h?h:b.minorTickStart},t.minorTickEnd=function(e){return arguments.length?(y=e,t):"undefined"!=typeof y?y:b.minorTickEnd},t.majorTickStart=function(e){return arguments.length?(m=e,t):"undefined"!=typeof m?m:b.majorTickStart},t.majorTickEnd=function(e){return arguments.length?(x=e,t):"undefined"!=typeof x?x:b.majorTickEnd},t.needleColor=function(e){return arguments.length?(r=e,t):"undefined"!=typeof r?r:b.needleColor},t.innerFaceColor=function(e){return arguments.length?(a=e,t):"undefined"!=typeof a?a:b.innerFaceColor},t.faceColor=function(e){return arguments.length?(i=e,t):"undefined"!=typeof i?i:b.faceColor},t.domain=function(e){return arguments.length?(u=e,t):"undefined"!=typeof u?u:b.domain},t.duration=function(e){return arguments.length?(c=e,t):"undefined"!=typeof c?c:b.duration},t.ease=function(e){return arguments.length?(d=e,t):"undefined"!=typeof d?d:b.ease},t.value=function(e){return arguments.length?(o=e,t):"undefined"!=typeof o?o:.5*(b.domain[0]+b.domain[1])},t.defs=function(e,n){var r=e.append("defs");f=n;var a=t.needleColor(),i=t.innerFaceColor(),u=t.faceColor(),o=v.defs(r).lG().id("vizgg1"+n).sel();v.defs(o).stop().offset("0").stopColor(a),v.defs(o).stop().offset("1").stopColor(d3.rgb(a).darker(1));var s=v.defs(r).rG().id("vizgg2"+n).fx("35%").fy("65%").r("65%").spreadMethod("pad").sel();v.defs(s).stop().offset("0").stopColor(i),v.defs(s).stop().offset("1").stopColor(d3.rgb(i).darker(2));var c=v.defs(r).rG().id("vizgg3"+n).fx("35%").fy("65%").r("65%").spreadMethod("pad").sel();v.defs(c).stop().offset("0").stopColor(u),v.defs(c).stop().offset("1").stopColor(d3.rgb(u).darker(2)),v.defs(r).lG().id("vizgg4"+n).gradientUnits("userSpaceOnUse").y1("80").x1("-10").y2("80").x2("10").xlink("#vizgg1"+n);var d=v.defs(r).filter().id("vizgg5"+n).sel();v.defs(d).feFlood().result("flood").floodColor("rgb(0,0,0)").floodOpacity("0.6"),v.defs(d).feComposite().result("composite1").operator("in").in2("SourceGraphic")["in"]("flood"),v.defs(d).feGaussianBlur().result("blur").stdDeviation("2")["in"]("composite1"),v.defs(d).feOffset().result("offset").dy("2").dx("2"),v.defs(d).feComposite().result("composite2").operator("over").in2("offset")["in"]("SourceGraphic");var l=v.defs(r).filter().x("-0.3").y("-0.3").height("1.8").width("1.8").id("vizgg6"+n).sel();v.defs(l).feGaussianBlur().stdDeviation("2")},t.setNeedle=function(e){function n(t,e){return d3.interpolateString("rotate("+t+")","rotate("+e+")")}var r=180*t.scale()(e)/A+90,a=180*t.scale()(t.value())/A+90,i=t.ease();l.selectAll(".needle").data([e]).transition().duration(t.duration()).attrTween("transform",function(t){return n(a,r)}).ease(i),l.selectAll(".needleshadow").data([e]).transition().duration(t.duration()).attrTween("transform",function(t){return n(a,r)}).ease(i).each("end",function(){angle=e}),t.value(e)},t},v.ch=function(){function t(e){function a(t){return h([z,j,t.startAngle,t.endAngle])}function i(t){return y(z,t.startAngle,t.endAngle,z,t.endStartAngle,t.endEndAngle)}u=e,A||r(),e.each(function(){var e=d3.select(this),r=e.selectAll(".groups").data(v).enter().append("g").attr("class","groups").on("mouseover",t.mouseover).on("mouseout",t.mouseout),u=r.append("text").attr("class","label"),o=(1+t.labelPadding())*t.outerRadius(),c=t.label();u.filter(function(t){return"g"==t.type}).attr("x",function(t){return o*Math.cos(n(t))}).attr("y",function(t){return o*Math.sin(n(t))}).text(c).style("text-anchor",function(t){var e=n(t);return k>e||e>x-k?"start":"end"}).each(function(t){this._current=t}),r.append("path").style("fill",function(t){return s(t.source)}).style("stroke",function(t){return s(t.source)}).attr("d",a).each(function(t){this._current=t}).filter(function(t){return"g"==t.type}),e.append("g").attr("class","chords").selectAll(".chord").data(A).enter().append("g").attr("class","chord").append("path").each(function(t){this._current=t}).attr("d",i).style("fill",function(t){return s(t.target)}).style("opacity",t.chordOpacity()).style("stroke",function(t){return s(t.target)}).style("display",function(t){return t.display?"inline":"none"})})}function e(e){function r(t,e){return h([z,j,t.startAngle,t.endAngle])}function a(t){return y(z,t.startAngle,t.endAngle,z,t.endStartAngle,t.endEndAngle)}function i(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return a(e(t))}}function o(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return r(e(t),t)}}function s(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return l*Math.cos(n(e(t)))}}function c(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return l*Math.sin(n(e(t)))}}var d=u.selectAll(".groups").data(e?b:t.groups()),l=(1+t.labelPadding())*t.outerRadius(),f=t.label();d.select("path").transition().duration(G).attrTween("d",o),d.select(".label").filter(function(t){return"g"==t.type}).transition().duration(G).attrTween("x",s).attrTween("y",c).text(f).style("text-anchor",function(t){var e=n(t);return k>e||e>x-k?"start":"end"});var g=t.chordOpacity();u.select(".chords").selectAll(".chord").data(e?w:t.chords()).select("path").transition().duration(G).attrTween("d",i).style("opacity",function(t){return t.display?g:0})}function n(t){return l((t.startAngle+t.endAngle)/2)}function r(){c=[],o.forEach(function(t){-1==c.indexOf(S(t))&&c.push(S(t)),-1==c.indexOf(M(t))&&c.push(M(t))}),c=c.sort(B),d={},g={},c.forEach(function(t){d[t]={},g[t]={},c.forEach(function(e){d[t][e]=0,g[t][e]=!1})}),o.forEach(function(t){var e=S(t),n=M(t);d[e][n]+=P(t),g[e][n]=!0}),v=[],c.forEach(function(t,e){v.push({source:t,type:"gs",value:0,skipPad:!0,index:e}),v.push({source:t,type:"g",value:d3.sum(c,function(e){return d[t][e]}),skipPad:!1,index:e})}),i(v,C,F,void 0,T),A=[],v.filter(function(t){return"g"==t.type}).forEach(function(t,e){var n=m(c.length,e),r=p(n.map(function(e){return d[t.source][c[e]]}),0,0,t.startAngle,t.endAngle);n.forEach(function(n,a){var i=r[a];A.push({startAngle:i.c-i.v/2,endAngle:i.c+i.v/2,value:i.value,source:t.source,target:c[n],type:"c",display:g[t.source][c[n]],index:e,subindex:n,indexsubindex:e+"-"+n})})});var t=d3.map(A,function(t){return t.indexsubindex});A.forEach(function(e){if(e.subindex==e.index)return e.endStartAngle=e.startAngle,void(e.endEndAngle=e.startAngle);var n=t.get(e.subindex+"-"+e.index);e.endStartAngle=n.startAngle,e.endEndAngle=n.startAngle}),I=!1}function a(t){function e(t){return t.endAngle+t.startAngle}var n=v.filter(function(e){return e.source==t&&"g"==e.type})[0];b=[],c.forEach(function(e,r){b.push({source:e,startAngle:n.startAngle,endAngle:n.endAngle,padAngle:n.padAngle,percent:n.percent,type:"gs",value:e==t?d[e][e]:0,skipPad:e==t&&g[e][e]?!1:!0,index:r}),e==t?b.push({source:e,startAngle:n.startAngle,endAngle:n.endAngle,padAngle:n.padAngle,percent:n.percent,type:"g",value:n.value,skipPad:!1,index:r}):b.push({source:e,type:"g",value:d[t][e],skipPad:!1,index:r})}),i(b,C,F,t,T);var r=e(n);v.forEach(function(t,n){var a=b[n],i=e(t)<r;a.startAngle-=i?x:0,a.endAngle-=i?x:0}),w=[],b.filter(function(t){return"g"==t.type}).forEach(function(e,n){var r=m(c.length,n),a=r.map(function(n){var r=c[n];return e.source==t?d[e.source][r]:r==t?d[r][e.source]:0}),i=p(a,0,0,e.startAngle,e.endAngle);r.forEach(function(r,a){var u=i[a];w.push({startAngle:u.c-u.v/2,endAngle:u.c+u.v/2,value:u.value,source:e.source,target:c[r],type:"c",display:e.source===t,index:n,subindex:r,indexsubindex:n+"-"+r})})});var a=d3.map(w.map(function(t){return{startAngle:t.startAngle,endAngle:t.endAngle,indexsubindex:t.indexsubindex}}),function(t){return t.indexsubindex}),u=d3.map(b.filter(function(t){return"gs"==t.type}),function(t){return t.source});w.forEach(function(e){if(e.subindex==e.index){var n=u.get(e.source);return e.endStartAngle=n.startAngle,void(e.endEndAngle=n.endAngle)}var r=a.get(e.subindex+"-"+e.index);e.endStartAngle=r.startAngle,e.endEndAngle=r.endAngle,e.source!==t&&(e.startAngle=e.endAngle,e.endEndAngle=e.endStartAngle)})}function i(t,e,n,r,a){var i=void 0!==r,u=0;if(i){for(var o=!1;u<t.length;u++)if(t[u].source==r&&"g"==t[u].type){o=!0;break}o||console.log("The fixed source '"+r+"' is not a valid key")}var s=d3.range(t.length);i&&(s=s.slice(u).concat(s.slice(0,u)));var c=t.filter(function(t){return!(i&&t.source===r&&"g"==t.type||t.skipPad)}).map(function(t){return t.value}),d=2*Math.PI-(i?t[u].endAngle-t[u].startAngle+2*e:0),l=i?t[u].endAngle+e:a,g=d3.sum(c),p=f(c,e,n,0>=d?0:d,g,i?!0:!1);s.slice(i?1:0).forEach(function(r){var a=p*t[r].value,i=(n>a?n-a:0)/2;t[r].startAngle=l,t[r].endAngle=l+a,t[r].padAngle=i,t[r].percent=t[r].value/(g||1),l+=a+i+(t[r].skipPad?0:e)})}var u,o,s,c,d,g,v,A,b,w,S=function(t){return t[0]},M=function(t){return t[1]},P=function(t){return t[2]},E=function(t){return t.source+" ("+t.value+")"},B=d3.ascending,C=.03,T=0,z=180,j=200,O=.7,L=.02,F=0,G=500,I=!0;return t.data=function(e){return arguments.length?(o=e,I=!0,t):o},t.fill=function(e){return arguments.length?(s=e,t):s},t.duration=function(e){return arguments.length?(G=e,t):G},t.chordOpacity=function(e){return arguments.length?(O=e,t):O},t.innerRadius=function(e){return arguments.length?(z=e,I=!0,t):z},t.outerRadius=function(e){return arguments.length?(j=e,I=!0,t):j},t.source=function(e){return arguments.length?(S=e,I=!0,t):S},t.target=function(e){return arguments.length?(M=e,I=!0,t):M},t.value=function(e){return arguments.length?(P=e,I=!0,t):P},t.padding=function(e){return arguments.length?(C=e,I=!0,t):C},t.labelPadding=function(e){return arguments.length?(L=e,t):L},t.sort=function(e){return arguments.length?(B=e,I=!0,t):B},t.startAngle=function(e){return arguments.length?(T=e,I=!0,t):T},t.chords=function(){return I&&r(),A},t.groups=function(){return I&&r(),v},t.label=function(e){return arguments.length?(E=e,t):E},t.mouseover=function(t){a(t.source),e(1)},t.mouseout=function(t){e(0)},t},v.defs=function(t){var e={},n=t;return e.sel=function(){return n},e.lG=function(){return n=n.append("linearGradient"),e},e.rG=function(){return n=n.append("radialGradient"),e},e.stop=function(){return n=n.append("stop"),e},e.filter=function(){return n=n.append("filter"),e},e.feFlood=function(){return n=n.append("feFlood"),e},e.feComposite=function(){return n=n.append("feComposite"),e},e.feOffset=function(){return n=n.append("feOffset"),e},e.feGaussianBlur=function(){return n=n.append("feGaussianBlur"),e},e.result=function(t){return n=n.attr("result",t),e},e.floodColor=function(t){return n=n.attr("flood-color",t),e},e.floodOpacity=function(t){return n=n.attr("flood-opacity",t),e},e.stdDeviation=function(t){return n=n.attr("stdDeviation",t),e},e.operator=function(t){return n=n.attr("operator",t),e},e.height=function(t){return n=n.attr("height",t),e},e.width=function(t){return n=n.attr("width",t),e},e["in"]=function(t){return n=n.attr("in",t),e},e.in2=function(t){return n=n.attr("in2",t),e},e.id=function(t){return n=n.attr("id",t),e},e.fx=function(t){return n=n.attr("fx",t),e},e.fy=function(t){return n=n.attr("fy",t),e},e.dx=function(t){return n=n.attr("dx",t),e},e.dy=function(t){return n=n.attr("dy",t),e},e.x1=function(t){return n=n.attr("x1",t),e},e.y1=function(t){return n=n.attr("y1",t),e},e.x2=function(t){return n=n.attr("x2",t),e},e.y2=function(t){return n=n.attr("y2",t),e},e.x=function(t){return n=n.attr("x",t),e},e.y=function(t){return n=n.attr("y",t),e},e.r=function(t){return n=n.attr("r",t),e},e.spreadMethod=function(t){return n=n.attr("spreadMethod",t),e},e.gradientUnits=function(t){return n=n.attr("gradientUnits",t),e},e.xlink=function(t){return n=n.attr("xlink:href",t),e},e.offset=function(t){return n=n.attr("offset",t),e},e.stopColor=function(t){return n=n.attr("stop-color",t),e},e.path=function(){return n=n.append("path"),e},e.d=function(t){return n=n.attr("d",t),e},e},v.bar=function(){function t(e){g=e,e.each(function(){var e=d3.select(this),n=t.bars(),s=t.dock(),c="t"==s||"b"==s,d=e.selectAll(".primarybars").data(n).enter().append("g").attr("class","primaryBars").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),l=d.selectAll(".secondaryBars").data(function(t){return t.values}).enter().append("g").attr("class","secondaryBars").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),f=t.fill(),g=l.append("rect").attr("width",a).attr("height",r),p=t.paddingLabel();void 0!==f&&g.style("fill",f),d.append("text").attr("class","primaryvalue").attr("x",function(t){return t.wf*t.width}).attr("y",function(t){return t.hf*t.height}).attr("dx",function(t){return 2*p*(t.wf-.5)}).attr("dy",function(t){return c?t.hf?3*p:-p:p}).style("text-anchor",function(t){return c?"middle":t.wf?"start":"end"}).text(t.valuePrimary()),d.append("text").attr("class","primarykey").attr("x",function(t){return(1-t.wf)*t.width}).attr("y",function(t){return(1-t.hf)*t.height}).attr("dx",function(t){return c?0:t.wf?-p:p}).attr("dy",function(t){return c?t.hf?-p:3*p:p}).style("text-anchor",function(t){return c?"middle":t.wf?"end":"start"}).text(o),l.append("text").attr("class","secondaryvalue").attr("x",u).attr("y",i).attr("dy",p).text(t.valueSecondary()).style("text-anchor","middle")})}function l(){var e=void 0===t.keySecondary(),n=d3.nest().key(t.keyPrimary()).sortKeys(t.sortPrimary());e||(n=n.key(t.keySecondary()).sortKeys(t.sortSecondary()));var r=t.value();return n=n.rollup(function(t){return d3.sum(t,r)}).entries(t.data()),e&&n.forEach(function(t){t.values=[{value:t.value}],delete t.value}),n}return t.data=c(t),t.width=d(t,400),t.height=d(t,400),t.dock=d(t,"b"),t.fill=d(t,void 0),t.paddingInner=d(t,.1),t.paddingOuter=d(t,.1),t.paddingLabel=d(t,6),t.value=d(t,n),t.keyPrimary=d(t,e),t.keySecondary=d(t,void 0),t.sortPrimary=d(t,d3.ascending),t.sortSecondary=d(t,d3.ascending),t.valuePrimary=d(t,s),t.valueSecondary=d(t,s),t.valueDomain=d(t,void 0),t.primaryKeys=function(){return d3.set(data,t.keyPrimary()).values().sort(t.sortPrimary())},t.keyScale=function(){var e=t.dock(),n={l:t.height(),r:t.height(),t:t.width(),b:t.width()};return d3.scaleBand().domain(t.primaryKeys()).range([0,n[e]]).paddingInner(t.paddingInner()).paddingOuter(t.paddingOuter())},t.valueScale=function(){var e=t.dock(),n="b"==e,r="l"==e,a="r"==e,i=t.height(),u=t.width(),o=r?[0,u]:a?[u,0]:n?[i,0]:[0,i],c=t.valueDomain();if(void 0==c){var d=l(),f=d3.min(d,function(t){return d3.sum(t.values,s)}),g=d3.max(d,function(t){return d3.sum(t.values,s)});c=[Math.min(0,f),g]}return d3.scaleLinear().domain(c).range(o)},t.bars=function(){var e=(t.data(),t.height()),n=t.width(),r=t.dock(),a="b"==r,i="l"==r,u="r"==r,o="t"==r||"b"==r,c=l(),d=t.keyScale(),f=t.valueDomain(),g=i?[0,n]:u?[n,0]:a?[e,0]:[0,e];if(void 0==f){var p=d3.min(c,function(t){return d3.sum(t.values,s)}),h=d3.max(c,function(t){return d3.sum(t.values,s)});f=[Math.min(0,p),h]}var y=d3.scaleLinear().domain(f).range(g),m=d.bandwidth(),v=y(0);return c.forEach(function(t){t.value=d3.sum(t.values,s);var e=y(t.value),n=Math.abs(e-v),r=Math.min(v,e);t.width=o?m:n,t.height=o?n:m,t.x=o?d(t.key):r,t.y=o?r:d(t.key),t.wf=o?.5:i?t.value<0?0:1:t.value<0?1:0,t.hf=o?a?t.value<0?1:0:t.value<0?0:1:.5;var u=0;t.values.forEach(function(e){e.primaryKey=t.key,e.secondaryKey=e.key,delete e.key;var n=y(u),r=y(u+=e.value),a=Math.abs(r-n),i=Math.min(n,r);e.width=o?m:a,e.height=o?a:m,e.x=o?0:i-t.x,e.y=o?i-t.y:0})}),c},t},v.lg=function(){function t(e){g=e,e.each(function(){var e=d3.select(this),n=t.rows(),r=t.data();n=void 0==n?r.length:Math.min(n,r.length);var a=Math.ceil(r.length/n),i=d3.scaleBand().domain(d3.range(n)).range([0,t.height()]).paddingInner(t.paddingInner()),u=d3.scaleBand().domain(d3.range(a)).range([0,t.width()]),o=t.size(),s=i.bandwidth(),c=(u.bandwidth(),t.paddingLabel()),d=d3.range(r.length).map(function(t){var e=t%a,n=(t-e)/a;return{x:u(e),y:i(n),width:o,height:s,key:r[t]}}),l=e.selectAll(".legendg").data(d,function(t){return t.key}).enter().append("g").attr("class","legendg").attr("transform",function(t){return"translate("+t.x+","+t.y+")"});l.append("text").attr("x",function(t){return o+c}).attr("y",function(t){return t.height/2}).attr("dy",6).text(function(t){return t.key}),l.each(t.draw());var f=t.fill();void 0!==f&&l.selectAll(".legend-icon").style("fill",f)})}return t.data=c(t),t.rows=d(t,void 0),t.width=d(t,100),t.height=d(t,200),t.paddingInner=d(t,.1),t.paddingLabel=d(t,6),t.size=d(t,12),t.fill=d(t,void 0),t.rect=function(t){d3.select(this).append("rect").attr("class","legend-icon").attr("height",r).attr("width",a)},t.circle=function(t){d3.select(this).append("circle").attr("class","legend-icon").attr("r",Math.min(t.height,t.width)).attr("cx",u).attr("cy",i)},t.draw=d(t,t.rect),t},v.uscs=function(){function e(n){g=n,t(),n.each(function(){function t(t){return"translate("+c([t.properties.LON,t.properties.LAT])+")"}var n=d3.select(this),r=e.state(),a=v.maps.uscounties.stateByAbb[r],i=v.maps.uscounties.objects.counties.geometries.filter(function(t){return t.properties.SFP===a.FP}),u=topojson.feature(v.maps.uscounties,{type:"GeometryCollection",geometries:i}).features,o=e.data();if(void 0!==o){var s=d3.map(o,e.countyFIPS());u.forEach(function(t){t.data=s.get(""+t.properties.SFP+t.properties.CFP)})}var c=d3.geoMercator().rotate(a.r).fitSize([e.width(),e.height()],topojson.merge(v.maps.uscounties,i)),d=d3.geoPath().projection(c),l=n.append("g").attr("class","counties"),f=n.append("path").attr("class","county-border"),g=n.append("path").attr("class","state-border"),p=n.append("g").attr("class","county-name");g.datum(topojson.merge(v.maps.uscounties,i)).attr("d",d),l=l.selectAll("path").data(u).enter().append("path").attr("d",d);var h=e.fill();void 0!==h&&l.style("fill",function(t){return h(t.data)}),p.selectAll("text").data(topojson.feature(v.maps.uscounties,{type:"GeometryCollection",geometries:i}).features).enter().append("text").attr("transform",t).text(function(t){return t.properties.CNM}),f.datum(topojson.mesh(v.maps.uscounties,{type:"GeometryCollection",geometries:i},function(t,e){return t!==e})).attr("d",d)})}return e.data=c(e),e.state=c(e),e.width=d(e,960),e.height=d(e,960),e.fill=d(e,void 0),e.countyFIPS=d(e,function(t){return t[0]}),e},this.viz=v}();